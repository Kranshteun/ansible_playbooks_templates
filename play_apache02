---
- name: Configure apache 
  hosts: myhosts
  tasks:
     - name: Update apt cache
       apt: update_cache=true
	   
     - name: Install necessary packages
       apt:
         name: apache2
         state: latest
		 
     - name: Configure server01 virtual host.
       copy: src=server01 dest=/etc/apache2/sites-available/server01.conf mode=0640

     - name: Create the server01 directory
       file:
         path: /var/server01
         state: directory
         mode: 0755

     - name: Deploy the server01 
       copy: src=index.html dest=/var/www/server01/
     
	 - name: Deactivate the default virtualhost
       command: a2dissite 000-default

     - name: Activate the virtualhost
       command: a2ensite helloworld
       notify:
         - restart apache
   handlers:
     - name: restart apache
       service: name=apache2 state=restarted
